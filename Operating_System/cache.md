## 캐시의 지역성

### 캐시의 지역성 원리

캐시 메모리는 속도가 빠른 장치와 느린 장치간의 속도차에 따른 병목 현상을 줄이기 위한 범용 메모리이다. 이러한 역할을
수행하기 위해서는 CPU가 어떤 데이터를 원할 것인가를 어느 정도 예측할 수 있어야 한다. 캐시의 성능은 작은 용량의 캐시
메모리에 CPU가 이후에 참조할, 쓸모 있는 정보가 어느 정도 들어있느냐에 따라 좌우되기 때문이다.

이때 ```적중률(Hit rate)```을 극대화 시키기 위해 데이터 ```지역성(Locality)의 원리```를 사용한다. 지역성의 전제조건으로
프로그램은 모든 코드나 데이터를 균등하게 Access하지 않는다는 특성을 기본으로 한다. 즉 Locality란 기억 장치 내의 정보를
균일하게 Access 하는 것이 아닌 어느 한 순간에 특정 부분을 집중적으로 참조하는 특성인 것이다.

이 데이터 지역성은 대표적으로 시간 지역성(Temporal Locality)과 공간 지역성(Spatial Locality)으로 나뉜다
- 시간 지역성 : 최근에 참조된 주소의 내용은 곧 다음에 다시 참조되는 특성
- 공간 지역성 : 대부분의 실제 프로그램이 참조된 주소와 인접한 주소의 내용이 다시 참조되는 특성

### Caching line

언급했듯이 캐시(cache)는 프로세서 가까이에 위치하면서 빈번하게 사용되는 데이터를 놔두는 장소이다. 하지만 캐시가
아무리 가까이 있더라도 찾고자 하는 데이터가 어느 곳에 저장되어 있는지 몰라 모든 데이터를 순회해야 한다면 시간이
오래 걸리게 된다. 즉, 캐시에 목적 데이터가 저장되어 있다면 바로 접근하여 출력할 수 있어야 캐시가 의미있어진다는
것이다.

그렇기 때문에 캐시에 데이터를 저장할때 특정 자료구조를 사용하여 묶음으로 저장하게 되는데 이를 ```캐싱 라인```이라고
한다. 프로세스는 다양한 주소에 있는 데이터를 사용하므로 빈번하게 사용하는 데이터의 주소 또한 흩어져 있다. 따라서
캐시에 저장하는 데이터에는 메모리 주소 등을 기록해 둔 태그를 달아놓을 필요가 있다. 이러한 태그들의 묶음을 캐싱
라인이라고 하고 메모리로부터 가져올 때도 캐싱 라인을 기준으로 가져온다. 종류로는 대표적으로 세 가지 방식이 존재한다

1. Direct Map

![image](https://user-images.githubusercontent.com/67304980/131681589-e74f3918-e42d-4555-9b7b-1fc1069beb78.png)

DRAM의 여러개 주소가 캐시메모리의 한 주소에 대응되는 다대일(n:1) 방식

간단하고 빠르지만 약점이 굉장히 크다. Conflict miss 문제가 굉장히 큰 방식이다. 캐시에서 0번 블록이 0라인에서 
수행하다가 사용자가 4번 블록을 사용함으로써 4번 블록이 올라가려 한다. 그러면 오랫동안 사용 안한 블럭이 캐시 3라인에
저장되어 있음에도 불구하고 규칙에 의해서 사용률이 높은 0번을 블록으로 내려야 한다. 즉 캐시 적정률이 저하된다

장점은 작은 용량의 RAM을 캐시 기억장치로 사용하기에 비용이 저렴하다는 것이다

2. Full Associative
  
비어있는 캐시메모리가 있으면 그냥 마음대로 주소를 저장하는 방식이다. 즉 저장시 크게 알고리즘 비용이 없어 간단하지만
찾을 때 문제이다. 모든 블럭을 순회해 데이터가 있는지 검사해야 한다. 이를 위해 CAM(Content Addressable Memory)라는
특수한 형태의 메모리 구조를 사용하는데, 가격이 비싸다


3. Set Associative
  
Direct Map과 Associative를 섞었다. 특정 로우를 지정해서 그 로우안의 어떤 열이든 비어있으면 저장한다.
DMC에 비해 검색은 오래 걸리지만 저장이 빠르며 Associative에 비해 저장이 느리지만 검색이 빠른 중간형이다.
현재 좋은 CPU 캐시들은 대부분 이 방식을 취하고 있다


























