## 컴퓨터 시스템의 동작 원리

### 컴퓨터 시스템의 구조
- 컴퓨터 내부장치 : CPU, 메모리
- 컴퓨터 외부장치 : CPU, 메모리 외 나머지


![a](https://user-images.githubusercontent.com/67304980/128183762-993a4835-84db-4c7e-b54d-0b63b04e2a34.JPG)

- 입력은 컴퓨터 내부로 데이터가 들어오고 출력은 컴퓨터 외부로 데이터가 나가는 것으로 컴퓨터 외부장치 = 입출력 장치

### CPU 연산과 I/O 연산
- 컴퓨터 연산 = CPU가 연산
- 입출력 장치의 I/O가 연산 = 입출력 컨트롤러가 연산
- 로컬버퍼 : 각 입출력 장치의 컨트롤러가 입출력된 데이터를 임시로 저장하는 작은 메모리
  - 디스크나 키보드 등에서 데이터를 읽어오는 경우
    - 컨트롤러가 장치로부터 데이터를 받아 로컬버퍼에 저장한다
    - 컨트롤러가 CPU의 서비스가 필요할 때 CPU에게 인터럽트 신호 발생시킨다(인터럽트 라인이라는 통로 이용)
- 프로그램이 디스크의 데이터 요청 -> 디스크 컨트롤러가 로컬버퍼로 데이터 읽어서 가져옴 -> 컨트롤러가 CPU에게 인터럽트 발생시킴 -> CPU는 인터럽트를 감지하고 관련 업무 수행

### 인터럽트의 일반적 기능
- 부팅이 끝나고 나면 운영체제는 메모리에 상주한다. 그리고 사건(event)를 기다리며 대기하는 상태이다
- 운영체제 커널에는 인터럽트가 들어왔을 때 해야 할 일이 다 프로그래밍되어 그 코드가 보관되어 있음
- 인터럽트에는 하드웨어 인터럽트, 소프트웨어 인터럽트가 있다
  - 하드웨어 인터럽트 : 컨트롤러 등 하드웨어 장치가 CPU의 인터럽트 라인을 세팅
    - 만약 우리가 마우스를 움직이면 전기 신호가 발생하고 CPU의 인터럽트 라인으로 연결되고 CPU는 마우스의 event를 인식한다. 그러면 CPU는 현재 하는 일을 중지하고 OS안에 있는 마우스 인터럽트 서비스 루틴(ISR)으로 이동한다. 여기에는 마우스를 움직이면 커서를 옮기는 루틴이 들어있다. 따라서 우리가 마우스를 움직이면 커서가 움직이게 된다. 키보드의 경우도 우리가 어떤 키를 누르면 전기신호가 전달되고 CPU가 OS의 키보드 인터럽트 루틴을 실행시켜서 결국 키보드를 누르면 그 값이 입력되는 것이다
  - 소프트웨어 인터럽트 : 소프트웨어가 인터럽트 라인을 세팅
    - int, swi 명령어가 입력되면 인터럽트가 작용되어 OS내의 특정 코드가 실행(ISR)된다. ISR 종료 후 사용자 프로그램으로 돌아간다.
- 인터럽트 벡터 : 인터럽트 종류마다 번호를 정해놓은 자료구조. 여기서 번호는 해야할일이 적힌 코드의 위치를 가리킴
- 인터럽트 처리루틴, 인터럽트 핸들러 : 실제 처리할 코드가 정의된 곳
- 보통 인터럽트라하면 하드웨어 인터럽트를 말한다. 그래서 소프트웨어 인터럽트를 구분하기 위해 트랩(trap)이라는 용어로 주로 불린다
  - 소프트웨어 인터럽트의 예
  - 예외상황(exception)
    - 0으로 나누거나, 자신의 메모리 바깥에 접근하려고 할 때 이에 대한 처리를 위해 발생시키는 인터럽트. OS안에 0으로 나눌 때의 ISR이 들어 있고 여기에서는 강제로 종료시키도록 하고 있다. 이런 내부 인터럽트에 의해 OS안에 ISR이 동작한다. 사용자가 갑자기 하드 디스크를 읽으려고 하면, OS안에 하드 디스크를 읽는 ISR이 실행된다. ISR이 작업을 마치면 OS는 대기상태가 되고 작업은 다시 사용자 프로그램으로 돌아오게 된다.
  - 시스템 콜(system call)
    - 사용자 프로그램이 운영체제 내부에 정의된 코드를 실행하고 싶을 때 운영체제에 서비스를 요청하는 방법
    - 사용자 프로그램이 CPU를 사용하고 싶다고 CPU를 제어하는 코드를 다 짤 수 없어서 인터럽트 라인 세팅을 통해 CPU 제어권을 넘겨 실행하게 한다
    - 사용자는 이미 존재하는 커널의 코드를 호출해서 처리한다
  - 시스템 콜이나 예외상황은 모두 사용자 프로세스로부터 CPU의 제어권이 운영체제에 이양되어 처리되는데, 이 과정에서 프로그램 코드가 직접 인터럽트 라인을 세팅하는 명령을 실행하여 인터럽트를 발생시킨 후 제어권이 넘어가게 되므로 이들도 넓은 의미에서 인터럽트의 범주에 포함시킨다
