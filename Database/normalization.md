## 정규화
- 이상 현상이 발생하지 않도록, 릴레이션을 관련 있는 속성들로만 구성하기 위해 릴레이션을 분해하는 과정
- **함수적 종속성**을 판단하여 정규화를 수행함

### 함수적 종속성(FD : Functional Dependency)
- 속성들 간의 관련성
- 함수 종속성을 이용하여, 릴레이션을 연관성이 있는 속성들로만 구성되도록 분해하여 이상 현상이 발생하지 않는 바람직한
릴레이션으로 만들어 나가는 과정이 정규화

### 함수 종속
- X가 Y를 함수적으로 결정한다
  - 릴레이션 내의 모든 튜플을 대상으로 하나의 X값에 대한 Y값이 항상 하나임
  - X와 Y는 하나의 릴레이션을 구성하는 속성들의 부분 집합
  - **Y가 X에 함수적으로 종속되어 있다**와 같은 의미
  - X -> Y로 표현(X는 결정자, Y는 종속자)

![image](https://user-images.githubusercontent.com/67304980/131967289-3e5b95c7-bbe0-4e36-9fa6-030d7c5c93b5.png)

#### 함수 종속 관계 판단 예 1

![image](https://user-images.githubusercontent.com/67304980/131967410-13cb4975-e406-4bed-a09b-61019d8c4e56.png)

고객아이디에 따라 고객이름을 결정한다, 고객아이디에 따라 등급을 결정한다.

고객이름이 등급을 결정한다(안됨) -> 만약 동명이인일 경우 이름이 같아도(X) 두 가지 등급(Y)이 존재할 수 있다.
하나의 X가 두 개의 Y값을 가지므로 안된다. 고객아이디가 PK라 중복이 안되므로 위의 관계가 가능하다

함수 종속 다이어그램 : 함수 종속 관계를 도식화하여 표현한 것

![image](https://user-images.githubusercontent.com/67304980/131968008-f6d67b62-61b3-4ed5-a5dc-f09ec33da3f6.png)

앞에 있는 고객아이디는 결정자, 화살표 표시 받는 고객이름, 등급은 종속자이다

#### 함수 종속 관계 판단 시 유의 사항
- 속성 자체의 특성과 의미를 기반으로 함수 종속성을 판단해야 한다
  - 속성 값은 계속 변할 수 있으므로 현재 릴레이션에 포함된 속성 값만으로 판단하면 안된다
  - 예를 들어 함수 종속 관계 판단 예 1 처럼 현재 상태로는 고객이름으로 등급을 판단할 수 있지만, 동명이인이 들어오게 되면
  고객이름으로 등급을 판단할 수 없다
  - 일반적으로 기본키와 후보키는 릴레이션의 다른 모든 속성들을 함수적으로 결정한다
  - 기본키나 후보키가 아니어도 다른 속성 값을 유일하게 결정하는 속성은 함수 종속 관계에서 결정자가 될 수 있다
  
#### 함수 종속 관계 판단 에 2

![image](https://user-images.githubusercontent.com/67304980/131970992-38d35516-dcc9-44a5-856d-4a7f8b7dae67.png)

고객아이디가 고객이름을 결정하고, '고객아이디 + 이벤트번호'가 당첨여부를 결정한다

![image](https://user-images.githubusercontent.com/67304980/131971300-3388f4c8-ab88-455c-9149-18fa6e014884.png)

#### 완전 함수 종속(FFD : Full Functional Dependency)
- 릴레이션에서 속성 집합 Y가 속성 집합 X에 함수적으로 종속되어 있지만, 속성 집합 X의 전체가 아닌 일부분에는 종속되지
않음을 의미
- **일반적으로 함수 종속은 완전 함수 종속을 의미함**
- 예) 당첨여부는 {고객아이디, 이벤트번호}에 완전 함수 종속됨

#### 부분 함수 종속(PFD : Partial Functional Dependency)
- 릴레이션에서 속성 집합 Y가 속성 집합 X의 전체가 아닌 일부분에도 함수적으로 종속됨을 의미
- 예) 고객이름은 {고객아이디, 이벤트번호}에 부분 함수 종속됨 -> 고객아이디만으로도 고객이름을 파악할 수 있음

#### 이행적 함수 종속(transitive FD)
- 릴레이션을 구성하는 세 개의 속성 집합 X,Y,Z에 대해 함수 종속 관계 X->Y와 Y->Z가 존재하면 논리적으로 X->Z가 성립되는데,
이것을 Z가 X에 이행적으로 함수 종속되었다고 한다

![image](https://user-images.githubusercontent.com/67304980/131972055-74f99fe1-9aed-41bb-9567-2c51b490ca45.png)

예를 들어 X가 고객 id, Y가 등급, Z가 할인율이라면 고객아이디가 등급을 결정하고등급이 할인율을 결정한다. 따라서 고객아이디에
따라 할인율이 결정되어 있다고 볼 수 있다

#### 고려할 필요가 없는 함수 종속 관계
- 결정자와 종속자가 같거나, 결정자가 종속자를 포함하는 것처럼 당연한 함수 종속 관계는 고려하지 않음

![image](https://user-images.githubusercontent.com/67304980/131972496-3959bb80-fb05-4360-b8a0-f2f215caaf93.png)

### 정규화(normalization)
- 함수 종속성을 이용해 릴레이션을 연관성이 있는 속성들로만 구성되도록 분해해서 이상 현상이 발생하지 않는 바람직한 릴레이션으로
만들어 가는 과정
- 정규화를 통해 릴레이션은 **무손실 분해**되어야 한다
  - 릴레이션은 의미적으로 동등한 릴레이션들로 분해되어야 하고 분해로 인한 정보의 손실이 발생하지 않아야 한다
  - 분해된 릴레이션들을 자연 조인하면 분해 전의 릴레이션으로 복원 가능해야 한다

### 정규형(NF : Normal Form)
- 릴레이션이 정규화된 정도
- 각 정규형마다 제약조건이 존재
  - 정규형의 차수가 높아질수록 요구되는 제약조건이 많아지고 엄격해진다
  - 정규형의 차수가 높아질수록 데이터 중복이 줄어 이상 현상이 발생하지 않는 바람직한 릴레이션이 된다
- 릴레이션의 특성을 고려하여 적합한 정규형을 선택

![image](https://user-images.githubusercontent.com/67304980/131973238-3572c484-6613-40da-84e1-c701d58f47ef.png)
![image](https://user-images.githubusercontent.com/67304980/131973265-5cbb5361-d17a-4d03-9226-82e8fac746e0.png)

### 제 1 정규형(1NF : First Normal Form)
- 릴레이션의 모든 속성이 더는 분해되지 않는 원자 값(atomic value)만 가지면 제 1 정규형을 만족함
- 제 1 정규형을 만족해야 관계 데이터베이스의 릴레이션이 될 자격이 있음

![image](https://user-images.githubusercontent.com/67304980/131975158-408522e7-e3f6-4b53-96d2-1ce1314d8ffc.png)

이벤트번호와 당첨여부에 다중 값을 포함한 경우가 있다. 속성의 값이 다중값을 가지므로 제 1정규형 제약조건을 만족하지 못한다

![image](https://user-images.githubusercontent.com/67304980/131975286-f46cd570-d992-4f5f-977c-63b799382220.png)

이렇게 각각의 속성값이 원자값으로만 구성되어 있으면 제 1정규형을 만족한다

![image](https://user-images.githubusercontent.com/67304980/131975493-a0f6c3a5-9e35-4f2d-a24f-51576f131b0a.png)

먼저 삽입이상이 발생할 수 있다. 고객아이디가 melon인 사람을 삽입하려 할 때, 이벤트에 참여하지 않았다면 이벤트번호에
null을 넣어야 하므로 삽입이상이 발생한다.
갱신이상은 만약 고객아이디가 apple인 사람의 등급을 vip로 변경한다고 할 때, 2개는 vip로 변경하고 하나는 갱신을 안한다면
동일한 고객아이디에 등급이 다르므로 갱신이상이 나타난다. 마지막으로 삭제이상은 만약 orange고객이 이벤트 참여 기록을
취소하고 싶다고 하면 이벤트번호와 당첨여부를 삭제해야 하는데 등급과 할인율과 같은 필요한 정보까지 삭제되는 삭제이상이
발생한다.

![image](https://user-images.githubusercontent.com/67304980/131975868-5e72410c-17b1-4340-b875-c530c512ddd8.png)

#### 이상 현상의 발생 이유
- 기본키인 {고객아이디, 이벤트번호}에 완전 함수 종속되지 못하고 일부분인 고객아이디에 종속되는 등급과 할인율 속성이 존재하기 때문

이를 해결하기 위해서는 부분 함수 종속이 제거되도록 이벤트참여 릴레이션을 분해

-> 분해된 릴레이션은 제 2정규형에 속하게 된다

### 제 2 정규형(2NF : Second Normal Form)

릴레이션이 제 1 정규형에 속하고, 기본키가 아닌 모든 속성이 기본기에 완전 함수 종속되면 제 2정규형을 만족

![image](https://user-images.githubusercontent.com/67304980/131999832-26c57c66-dc45-48c6-8d6c-00560511d4d8.png)
![image](https://user-images.githubusercontent.com/67304980/131999854-0c2aa9fc-fb69-45ca-8626-11274dda6a02.png)

(고객아이디, 이벤트번호)의 기본키에 따라 등급과 할인율이 결정되는 것이 아니라, 고객 아이디만으로 등급과 할인율이
결정되기 때문에 부분 함수 종속되었다고 할 수 있다

![image](https://user-images.githubusercontent.com/67304980/131999951-92ed4865-d946-4a28-aefa-133885b125ef.png)

이 릴레이션은 이상 현상이 발생할 수 있는데 구체적인 예를 살펴보자

![image](https://user-images.githubusercontent.com/67304980/131999995-f08bfde7-6484-42d9-83d7-a4d7a68499bf.png)

gold등급의 할인율을 15로 올릴때 일부만 올린다면 갱신이상이 발생한다
만약 banana를 지운다면 vip등급의 할인율이 20%라는 데이터도 삭제되게 된다.
새로운 bronze 등급과 할인율을 정했는데 해당 등급 고객이 없다면 삽입 불가로 인한 삽입이상이 발생한다.
이행적 종속 관계는 A->B, B->C일 때 A->C를 의미하는 것이다. 고객아이디가 등급을 결정하고,
등급이 할인율을 결정하는 이행적 함수 종속이 존재한다. 이러한 이행적 함수 종속이 제거되도록 고객 릴레이션을 분해한다.
분해한 릴레이션은 제 3 정규형에 속하게 된다.

### 제 3 정규형(3NF : Third Normal Form)

릴레이션이 제 2 정규형에 속하고, 기본키가 아닌 모든 속성이 기본키에 이행적 함수 종속되지 않으면 제 3 정규형 만족

![image](https://user-images.githubusercontent.com/67304980/132000628-a9e4fb0e-aa94-4a7c-9407-5ec037c2fb10.png)
![image](https://user-images.githubusercontent.com/67304980/132000657-f733bd49-9254-4a9d-8682-2c8fa52aeef5.png)

이렇게 고객 릴레이션과 고객등급 릴레이션으로 나누면 모두 제 3 정규형에 속하게 된다
