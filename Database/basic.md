## 데이터베이스

특정 조직의 여러 사용자가 공유하여 사용할 수 있도록 통합해서 저장한 운영 데이터의 집합이다

데이터베이스의 특징과 예제를 합쳐 설명하면

데이터베이스의 특징 - 쇼핑몰 예제
- 실시간 접근 가능 -> 목록 조회
- 계속적으로 변화 -> 구입정보, 물건재고 정보
- 동시 공유가 가능 -> 많은 고객이 동시 접속, 구매 가능
- 저장된 주소가 아닌 내용으로 참조 가능 -> 가장 많이 팔린 제품은?



### 데이터베이스 용어정리

데이터베이스 기본 용어를 먼저 정리하겠다

### 데이터베이스 관리시스템(DBMS)
- 파일시스템의 데이터중복과 데이터 종속 문제를 해결하기 위해 제시된 소프트웨어
- 데이터베이스의 생성과 관리를 담당
- 모든 응용프로그램은 데이터베이스 공유 가능, DBMS 통해 데이터 삽입, 수정, 검색

![image](https://user-images.githubusercontent.com/67304980/139417280-9008bb4c-72ef-4da7-8474-7cad13e91ada.png)


#### [나의 정리]
> 과거에는 데이터 관리를 위해 파일시스템을 사용했는데, **데이터**를 **파일**로 관리할 수 있도록 파일을 생성, 삭제, 수정, 검색하는 기능을 제공했다. 그런데 이런 방식은 중복된 데이터가 저장되거나 응용프로그램이 파일에 직접 접근하여 데이터를 처리해야 했으므로 데이터를 구성하는 방법이나 물리적 저장 구조에 맞게 작성되어야 했다. 즉 파일의 구조에 따라서 응용프로그램의 구조도 영향을 받게 되어 응용프로그램이 파일에 종속되어있다고 할 수 있다. 이러한 문제들을 해결하는 시스템은 중복된 데이터가 저장되지 않도록 하고, 어떤 응용프로그램이라도 데이터베이스에 접근할 수 있어야 했다. 그래서 응용프로그램과 저장된 데이터 사이에 DBMS가 존재하여 응용프로그램의 데이터 관련 요청을 받아 DBMS가 데이터베이스를 생성,접근,관리를 담당하고 알맞은 결과를 응용프로그램에 돌려주는 것이다. 

## DBMS 주요 기능과 장단점
- 정의 기능 : 데이터베이스 구조를 정의하거나 수행
- 조작 기능 : 데이터를 삽입, 삭제, 수정, 검색하는 연산을 수행
- 제어 기능 : 데이터를 항상 정확하고 안전하게 유지하는 기능

#### [장점]
- 파일시스템의 데이터 중복 문제 해결
- 데이터 독립성 확보(데이터 구조가 바뀌어도 응용프로그램을 바꿀 필요 없음)
- 데이터 동시 공유(Concurrency control) : 동시성 제어
- 데이터 보안 향상 : 사용자별 접근 가능한 데이터베이스 영역 제한 가능
- 데이터 무결성 유지
- 표준화 방식으로 데이터에 접근(with 데이터베이스 언어)
- 장애 발생 후 회복 시 데이터 일관성과 무결성 유지 : 트랜잭션 가능
- 응용 프로그램 개발 비용이 줄어듬

#### [단점]
- DBMS 구매 비용
- 응용프로그램이 DBMS를 통해 데이터에 접근하기 때문에 추가적인 오버헤드가 있다
- 응용프로그래머가 DBMS가 어떻게 동작하는지와 표준 데이터 언어에 대한 지식 필요
- DBMS 장애가 발생할 때 모든 응용프로그램 장애가 발생함

#### [나의 정리]
> DBMS의 핵심은 데이터 관리에 대한 책임이 DBMS에 집중되어 있는 것에 있다. 데이터 관리에 필요한 기능을 하나의 개체에 집중화시켜 우리가 데이터 관리에 필요한 기능들을 그 곳에만 추가하면 원하는 결과를 얻을 수 있는 것이다. 중복된 데이터를 막는 기능, 데이터 무결성을 유지하는 기능(데이터의 정확성. 즉 학생 성적이 100점인데 10점으로 저장하거나 음수로 저장하면 무결성을 위반한 것) 등을 추가할 수 있고, 다양한 응용프로그램이 하나의 DBMS로 접근하고 DB를 관리하는 모든 책임을 지기 때문에 DB의 구조가 변경되어도 응용프로그램이 영향을 받지 않고 데이터에 접근하는 방법이나 데이터 형식, 구조를 표준화하기 쉽다. 또한 DB의 일관성과 무결성을 유지하기 위해 허용되지 않은 접근과 연산을 차단하고, 사용자별로 접근 수준을 차별화할 수 있다. 또한 장애 발생시 이전 상태로 되돌리는 회복이 가능하다. 마지막으로 이전에는 데이터베이스에 맞게 응용프로그램을 개발해야 했기 때문에 응용프로그램 개발 비용이 높았지만, DBMS 도입으로 인해 응용프로그램 개발 비용이 줄어들게 된다. 하지만 단점 또한 존재하는데, DBMS를 구매하는 비용이 추가적으로 든다는 것이다. 동시 사용자의 수에 따라 제품 가격도 증가한다. 또한 데이터에 대한 책임과 관리를 하는 DBMS를 통해 접근하므로 관리 기능을 수행하기 때문에 추가적인 오버헤드가 발생한다. 중복 데이터에 대한 검사를 해야 할 것이고, 올바른 값이 들어왔는지에 대한 검사, 회복 등 추가적인 처리와 연산이 들어간다. 참고로 오버헤드는 "어떤 처리를 위해 들어가는 간접적인 처리 시간, 메모리 등"을 말한다. 또한 사용자는 DBMS의 동작 방식과 표준 데이터 접근 언어를 알아야 데이터를 처리할 수 있다. 마지막으로 이렇게 중앙 집중화된 방식에서 DBMS가 장애가 날 경우에는 모든 응용프로그램이 해당 데이터 처리를 할 수 없어 큰 장애가 발생한다.




### Data Dictionary(System Catalog)
- DBMS는 database와 함께 metadata(data about data)를 저장한다
- 데이터 정의어(DDL)에 의해 생성된다. 기본 테이블, 뷰, 인덱스, 패키지, 접근 권한 등의 데이터베이스 구조 및 통계 정보를 저장한다
- 시스템 그 자체에 관련이 있는 다양한 객체에 관한 정보를 포함하는 **시스템 데이터베이스**이다
- 시스템 카탈로그 내의 각 테이블은 사용자를 포함하여 DBMS에서 지원하는 모든 데이터 객체에 대한 정의나 명세에 관한 정보를 유지 관리하는 시스템 테이블이다
- 카탈로그들이 생성되면 자료사전에 저장되기 때문에 좁은 의미로는 카탈로그를 자료 사전이라고 한다
- 카탈로그에 저장된 정보를 메타 데이터라고 한다

### 카탈로그의 특징
- 카탈로그 자체도 시스템 테이블로 구성되어 있어 일반 사용자도 SQL을 이용하여 내용을 검색할 수 있다
- 어떠한 사용자도 INSERT, DELETE, UPDATE(DML)문으로 시스템 카탈로그를 직접 갱신하는 것은 **허용되지 않는다**
- 데이터 정의어(DDL)을 통해서만 시스템 카탈로그를 갱신할 수 있다
    - ALTER TABLE EMPLOYEE DROP COLUMN MANAGER
- 시스템 카탈로그는 DBMS가 스스로 생성하고 유지한다
- 카탈로그는 사용자가 SQL문을 실행시켜 기본 테이블, 뷰, 인덱스 등에 변화를 주면 **시스템이 자동으로 갱신**된다

### 시스템 카탈로그의 종류
- SYSTABLES : 기본 테이블 및 뷰 테이블의 정보를 저장하는 테이블
- SYSCOLUMNS : 모든 테이블에 대한 정보를 열(속성) 중심으로 저장하는 테이블
- SYSVIEW : 뷰에 대한 정보를 저장하는 테이블
- SYSTABAUTH : 테이블에 설정된 권한 사항들을 저장하는 테이블
- SYSCOLAUTH : 각 속성에 설정된 권한 사항들을 저장하는 테이블

### Metadata
- 시스템 카탈로그에 저장된 정보를 메타 데이터라고 한다
- 각 데이터에 접근할 수 있는 데이터의 이름(테이블, 컬럼 이름)
- 스토리지에 데이터가 저장된 위치
- 보안을 위한 제약(security constraint) : 누가 어떤 데이터를 접근할 수 있나
- 무결성을 위한 제약(integrity constraint) : 어떤 값이 데이터에 유효하나


#### [나의 정리]
> 데이터를 관리하기 위해 DBMS를 사용하는데, 그렇다면 DBMS는 어떻게 데이터를 관리할 수 있을까? 저장된 데이터에 대한 데이터가 있어야 그것들을 기반으로 데이터를 관리할 수 있을 것이다. 그런 데이터에 대한 데이터는 우리가 데이터베이스를 생성하기만 하면 그 시스템에 관련 있는 객체의 정보들이 시스템 카탈로그에 포함되어 생성된다. 즉 시스템 카탈로그 내의 테이블들은 데이터 객체에 대한 정의와 명세에 관한 정보를 갖고 있다. 이 카탈로그들은 자료사전에 저장되며, 각 카탈로그 안에 저장된 정보를 메타데이터라고 한다. 이러한 카탈로그는 데이터 자체에 대한 데이터의 명세이므로 데이터 조작어가 아닌 데이터 정의어(DDL)로만 갱신이 가능하며, 사용자가 테이블, 뷰, 인덱스 등 필요한 갱신 작업으로 하면 시스템은 자동으로 카탈로그를 갱신하게 된다. 시스템 카탈로그에는 기본 테이블이나 뷰 테이블의 정보를 저장, 테이블 정보를 열 중심으로 저장, 뷰에 대한 정보 저장, 권한 사항 저장 등 테이블을 갖고 있으며 그 각각의 기능을 하는 테이블에 실제 저장되어 있는 데이터가 메타 데이터이다. 메타 데이터에는 각 데이터에 접근할 수 있는 데이터 이름, 데이터 저장 위치, 제약 조건 등이 저장되어 있다. 이렇게 DBMS는 데이터에 대한 데이터를 저장하고 활용함으로써 우리가 가진 대량의 데이터에서 원하는 데이터를 효율적으로 찾아내고 이용할 수 있도록 한다. 즉 데이터를 표현하고 이를 기반으로 데이터를 빨리 찾기 위한 목적으로 사용한다. 



## 테이블(Table)
- 행과 열로 이루어진 데이터의 집합을 테이블이라고 한다
- 흔히 생각하는 엑셀을 떠올리면 편하다
- 일반적인 데이터베이스에서는 행과 열만 있으면 테이블이라고 하지만, 관계형 데이터베이스에서는 여기에 특별한 제약을 추가해서
```릴레이션(Relation)```이라고 부른다
- 아래 조건을 충족하는 테이블만이 릴레이션이 될 수 있기 때문에 모든 릴레이션은 테이블이지만, 모든 테이블이 릴레이션인건 아니다

1. 모든 값은 유일한 값을 가진다
2. 하나의 릴레이션에서 중복되는 행이 존재하면 안된다

### 행(Row)
- 테이블을 구성하는 데이터들 중 가로로 묶은 데이터셋을 의미한다
- 일반적으로 행은 한 객체에 대한 정보를 가지고 있다
- 이또한 관계형 데이터베이스에서는 튜플 또는 레코드라는 이름으로 불린다

### 열(Column)
- 테이블을 구성하는 데이터들 중 세로로 묶은 데이터셋을 의미한다
- 일반적으로 열은 그 테이블의 속성을 의미하며 열을 구성하는 값들은 ```도메인(Domain)```으로 되어 있다
- 이 또한 관계형 데이터베이스에서는 ```속성(Attribute)```이라는 이름으로 불린다

### 도메인(Domain)
- 데이터베이스에서 필드(Field)에 채워질 수 있는 값의 집합이다
- 예를 들어, 도메인이 1에서 10사이의 정수인 속성의 필드에 11이나 -1처럼 도메인을 벗어나는 값 또는 "고양이"처럼 아예 자료형이
다른 값이 들어갈 수 없다
- (논외) 카디널리티 : 튜플의 수


### 스키마(Schema)
- 데이터베이스의 논리적 구조와 제약조건을 전반적으로 기술한 것을 말한다
- 구체적으로 데이터베이스를 구성하는 데이터 레코드의 크기, 키의 정의, 레코드 간의 관계 등을 정의한 것을 말한다
- 사용자의 관점에 따라 외부 스키마, 개념 스키마, 내부 스키마로 구분한다
- DBMS는 외부 스키마에 명세된 사용자의 요구를 개념 스키마 형태로 변환하고, 이를 다시 내부 스키마 형태로 변환한다

![image](https://user-images.githubusercontent.com/67304980/135084493-b60028ed-69a8-4a72-a662-d9a0743ac2d7.png)


![image](https://user-images.githubusercontent.com/67304980/133926839-a2c3e6f1-8903-485b-8984-adc280e4505f.png)

인스턴스(instance) : 정의된 스키마에 따라 데이터베이스에 실제로 저장된 값




## 3단계 데이터베이스 구조(3 level database architecture)

미국의 기관인 ANSI/SPARC에서 데이터베이스의 내부 구조를 감추고 일반 사용자가 데이터베이스를 쉽게 이용하고
사용할 수 있게 하는 구조 제안

![image](https://user-images.githubusercontent.com/67304980/135084657-c21e916f-8160-4115-b3c2-7c9c84d940a0.png)


#### 외부 스키마
- 사용자의 입장에서 정의한 데이터베이스의 논리적 구조(사용자가 보는 view level)
- 사용자에게 view의 형태로 필요한 정보만 보여주는 단계
- 데이터들을 어떤 형식, 구조, 화면을 통해 사용자에게 보여줄 것인가에 대한 명세를 말하며 하나의 데이터베이스에는 여러 개의
외부 스키마가 있을 수 있다(각 사용자가 생각하는 데이터베이스의 모습, 논리적 구조로 사용자마다 다른 모습)
- 일반 사용자에게는 질의어를 이용해 DB를 쉽게 사용할 수 있도록 하고 응용 프로그래머는 언어를 사용해서 DB에 접근하도록 한다
- 각 사용자들이 개별 요구 사항에 따라 다른 view를 정의해서 데이터를 볼 수 있다
- 데이터베이스 하나에 여러 개의 외부 스키마 

#### 개념 스키마
- 일반적인 스키마
- 조직체 전체를 관장하는 입장에서 DB를 정의한 스키마(데이터베이스 하나에 개념 스키마가 하나만 존재함)
- DB에 대한 모든 논리적 구조를 기술하기 때문에 데이터베이스에 하나만 존재하며, 통상 스키마라고 하면 개념 스키마를 일컫는다
- 전체 데이터베이스에 어떤 데이터가 저장되는지, 데이터들 간에는 어떤 관계가 존재하고 어떤 제약조건이 존재하는지에 대한 정의뿐만 아니라, 데이터에 대한 보안 정책이나 접근 권한에 대한 정의도 포함(데이터를 효과적으로 관리하기 위한 다양한 기능 개념)

#### 내부 스키마
- 데이터베이스 하나에 내부 스키마가 하나만 존재함
- 데이터베이스가 어떻게 저장 장치에 저장될지에 대한 명세
- 레코드 구조(사이즈), 필드 크기, 레코드 접근 경로, 압축방법, 암호화 방법 등 물리적인 저장 구조를 정의
- 물리적인 저장 장치와 데이터베이스 간의 관계를 정의하므로 시스템 프로그래머나 시스템 설계자가 보는 관점의 스키마이다

![image](https://user-images.githubusercontent.com/67304980/133927270-bfb3c544-09fc-46f0-b92b-6d92885249a2.png)

![image](https://user-images.githubusercontent.com/67304980/133927276-8893ab87-e79b-4027-a3ae-e956ad086f9c.png)


#### [나의 정리]
> 데이터베이스를 3가지 관점으로 나눈 것은 사용자별로 데이터베이스를 보는 관점이 다름을 인식하고 사용자별로 데이터베이스를 원하는 범위까지 확인하고 쉽게 이용할 수 있게 하기 위함이다. 모든 사용자가 데이터베이스의 구조적 정보부터 실제 데이터까지 데이터베이스의 모든 것을 보고 사용할 필요는 없기 때문이다. 먼저 외부 스키마는 일반 사용자가 보는 view라고 할 수 있다. 일반 사용자는 전체 데이터베이스에서 일부분만 필요한 경우가 많다. 질의어나 프로그램 언어를 사용하여 쉽게 DB를 사용할 수 있으며 사용자가 요구 사항에 맞게 view를 정의하여 데이터를 확인할 수 있다. 즉 사용자의 요구 사항이 다양하기 때문에 이에 맞게 외부 스키마도 여러 개일 수 있다. 개념 스키마는 데이터베이스 하나에 하나만 존재하며 모든 논리적 구조를 기술한 것이다. 앞서 배운 시스템 카탈로그와 같이 어떤 데이터가 저장되는지, 테이블간 관계나 제약조건, 접근권한, 보안 등 데이터를 효과적으로 관리하기 위한 DBMS로서의 주 기능의 실현을 위한 것이라고 볼 수 있다. 내부 스키마 또한 데이터베이스 하나에 하나만 존재한다. 앞서 개념 스키마에서 논리적으로 기술된 것을 어떻게 물리적으로 저장할 것인가에 대한 서술이다. 실제 레코드의 구조나 사이즈, 필드 크기, 레코드 접근 경로, 압축방법, 암호화 방법 등 물리적 저장 구조를 정의한다.




### 3단계 데이터베이스 구조의 사상 또는 매핑

- 데이터의 독립성 실현
- 스키마 사이의 대응 관계 / 관계와 관계를 정의하는 것
- 미리 정의된 사상 정보를 이용하여 사용자가 원하는 데이터에 접근(고객분석팀에서 고객 정보 데이터 접근)
- 데이터베이스를 3단계 구조로 나누고 단계별로 스키마를 유지하며 스키마 사이의 대응 관계를 정의하는 목적

![image](https://user-images.githubusercontent.com/67304980/133927342-0f6d2338-fa05-4ac8-82aa-6a517ba468d4.png)

1) 외부/개념 사상 - 응용 인터페이스(application interface)
- 외부 스키마와 개념 스키마의 대응 관계

2) 개념/내부 사상 - 저장 인터페이스(storage interface)
- 개념 스키마와 내부 스키마의 대응 관계

### 데이터 독립성(Data Independency)
- 파일 시스템의 종속성 문제 해결
- 하위 스키마를 변경하더라도 상위 스키마가 영향을 받지 않는 특성

1) 논리적 데이터 독립성(응용 인터페이스 독립성 유지)
- 개념 스키마가 변경되어도 외부 스키마가 영향을 받지 않음
- 개념 스키마가 변경되면 관련된 외부/개념 사상만 정확하게 수정해주면 됨

2) 물리적 데이터 독립성(저장 인터페이스 독립성 유지)
- 내부 스키마가 변경되어도 개념 스키마는 영향을 받지 않음
- 내부 스키마가 변경되면 관련된 개념/내부 사상만 정확하게 수정해주면 됨


### 데이터베이스 사용자
1. 데이터베이스 관리자(DBA)
    - 데이터베이스 시스템을 운영하고 관리
    - 데이터베이스를 설계 및 구축, 제어
    - DBMS 자체는 물론 데이터베이스 구축, 관리에 해박한 지식과 많은 경험이 요구됨

2. 응용 프로그래머
    - 데이터베이스 언어를 이용하여 응용프로그램을 작성

3. 최종 사용자(End User)
    - 데이터베이스에 접근하여 데이터를 조작
    - casual end user : 데이터베이스 언어를 이용해 데이터베이스 접근 및 조작
    - native end user : 데이터베이스 언어를 쓰지 않고 응용프로글매을 통해 데이터베이스 접근

![image](https://user-images.githubusercontent.com/67304980/135086041-f7c5051d-1ae4-4457-9ae3-cea4a782d0e8.png)

### 질의 처리기

DDL Interpreter
- DDL로 작성된 스키마의 정의를 해석, 데이터베이스를 생성하거나, 스키마의 정의를 데이터 딕셔너리(Catalog)에 저장
- 데이터베이스 관리자의 데이터 정의어에 의해 실행된다

DML Compiler
- DML로 작성된 데이터 처리 요구를 processing engine이 이해할 수 있는 코드로 해석하여 plan을 작성
- 즉 데이터 조작어(삽입,삭제,수정,검색) 요청을 분석하여 Processing Engine이 이해할 수 있도록 해석한다

DML(Query) Processing Engine
- DML 컴파일러로 부터 전달받은 요청(컴파일된 plan)을 데이터베이스에 실제로 실행

트랜잭션 관리자(transaction manager)
- 데이터베이스에 접근하는 과정에서 사용자의 접근 권한이 유효한지 검사하고, 데이터베이스 무결성을 유지하기 위한 제약조건 위반 여부를 확인한다. 회복이나 병행 수행과 관련된 작업도 한다

저장 데이터 관리자(stored data manager)
- 저장 데이터 관리자는 디스크에 저장되어 있는 사용자 데이터베이스와 데이터 사전을 관리하고 접근한다
- 하지만 디스크에 저장된 데이터에 접근하는 것은 운영체제의 기본 기능이므로 저장 데이터 관리자는 운영체제의 도움을 받아 데이터베이스에 대한 접근을 수행한다

![image](https://user-images.githubusercontent.com/67304980/135086630-c5b81a62-1063-44c6-bebb-6754f27c8919.png)

#### [나의 정리]
> DBMS에 접근하는 사용자별로 요청이 다르므로 DBMS내의 처리 작업도 달라지게 된다. 데이터베이스 관리자의 경우 DDL을 작성하고 이 요청은 DDL 컴파일러(혹은 DDL 인터프리터)로 전송되어 DDL문을 해석하고, 데이터베이스를 생성,삭제,수정하고 스키마의 정의를 데이터 딕셔너리(시스템 카탈로그)에 정리한다. 일반 사용자는 응용 프로그램 인터페이스를 이용하여 응용프로그램을 거쳐 요청이 DML 컴파일러에 도달하고, 응용 프로그래머는 직접 응용프로그램에서 요청하여 DML컴파일러에 도달하게 된다. DML Processing Engine은 컴파일러로부터 전달받은 요청(컴파일된 plan)을 데이터베이스에 실제로 실행하려고 한다. 하지만 그 전에 트랜잭션 관리자가 사용자의 접근 권한, 제약조건을 체크하고 이상이 없을 시 요청은 저장 데이터 관리자에게 도달한다. 저장 데이터 관리자는 데이터베이스와 데이터 사전(시스템 카탈로그)를 관리하며 직접 접근이 가능하다. 하지만 저장 데이터 관리자가 독단적으로 데이터베이스에 접근하는 것은 아니다. 데이터는 디스크에 저장되어 있기 때문이다. 디스크에 접근하는 것은 운영체제의 기능이므로 저장 데이터 관리자는 운영체제의 도움(시스템 콜)을 받아 데이터베이스에 접근하여 데이터베이스의 상태를 변경할 수 있다. 이처럼 DBMS는 사용자별로 다양한 요구를 처리하며 편의성을 제공한다.












